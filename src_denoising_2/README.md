# z2_gz

# Данный раздел посвящен задаче фильтрации.

#### - 'src_denoising_2' - папка с решением задачи фильтрации
    - 'models' - папка с моделью
      - 'download_model_denoise.sh' - файл для скачивания модели фильтрации
    - 'model.py' - файл с моделью (не используется)
    - 'unn_model.py' - файл с моделью (используется)
    - 'process_den.py' - файл с предобработкой датасета
    - 'train_den.py' - скрипт с обучением 
    - 'predict_den.py' - скрипт с получением предсказанием с оценкой точности для проверочного набора данных
    - 'README.md' - инструкция для использования


## Инструкция:
### Этап обучения:
   1) В папку с проектом необходимо поместить папку с набором данных состоящая из папок clean и noisy (Пример формата: dataset/train/train)
   2) В скрипте "process_den.py" в переменной INPUT_DIR указать путь до набора данных (Пример: '/home/sheins/z2_gz/dataset/train/train') (Добавить тут parser и корректное взаимодействие с путями) 
      Запусть скрипт. В результате работы он создаст два файла 'x_no_0.npy' и 'y_cl_0.npy' с входными и выходными данным
      соответственно
   3) Для запуска обучнеия по аналогии с пунктом 2 исправиить переменную INPUT_DIR в скрипте 'train_den.py'. Дополнительно при каждом запуски исправить названия переменных 'checkpoint_path' и название сохраняемой модели в переменной 'save_path'. 
      После обучения модель сохраняется в папке 'models'. 
### Этап классификации:
   1) Полученную модель можно скачать запустив sh скрипт из папки 'models'. Необходимо через терминал открыть папку 'src_denoising_2/models' и запустить команду:

           sh download_model_denoise.sh
   2) Далее для фильтрации используется скаченная модель. Для получения предсказания можно использовать скрипт 'predict_den.py' или 'predict.sh', при этом заменив в нем предварительно путь до проверочного примера.
    Альтернативный вариант запустить следующую команду в терминале из папки 'src_denoising_2':
    
            python predict_den.py -d /home/sheins/z2_gz/dataset/val/val/clean/5765/5765_231845_5765-231845-0029.npy
        Путь приведен в качетсве примера для одного примера
    Для оценки (аналогичный скрипт для нескольких) необходимо запустить скрипт 'predict_den.py' с командой:

            python predict_den.py -d /home/sheins/z2_gz/dataset/val/val
   Путь приведен в качетсве примера. Файл 'predict_den.py' содержит parser со следующими флагами:
            
            -m '--model_dir' - путь до модели в формате h5
            -d '--data_dir' - путь до проверочного набора данных хранящийся в папке и разделенный на clean и noisy
   4) В результате работы скрипт выводит результат MSE по сравнению изначальной ошибки между чистой и 
      зашумленной спектограммой, а затем выводит значени между чистой и фильтрованной спектрограммой. 
      Значения выводятся последовательно для каждого примера. Затем выводится среднии ошибки по всем примерам. 
      (Может не совсем корректно, требует правки)

#### Комментарий: 
Все файлы требуют значительной доработки по соверенствованию взаимодейтсвию модулей, ведению экспериментов и т.д. Ниже минимальный список TODO


# TODO:
- [X] Реализовать заготовку
- [X] Добавить arg parser
- [X] Написать скрипты для запуска
- [X] Добавить скрпт на скачивание модели
- [ ] Добавить CONFIG file
- [ ] Добавить нормальные sh скрипты для запусков
- [ ] Добавить корректное взаимодейтсвие с путями, проверки и т.д.
- [ ] Обернуть в MlFlow


